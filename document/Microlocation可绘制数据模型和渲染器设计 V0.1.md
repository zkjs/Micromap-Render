# Microlocation可绘制数据模型和渲染器设计 V0.1
曹朝


## 简介

为了兼容BLE定位、小区设施、路边停车场设施的自定义地图对象的绘制，保证一定的绘制效果，设计可绘制数据模型和渲染算法。目的是基于高德地图提供的部分功能，逐步实现自定义地图和对象的绘制能力。要求效果要优于滴滴打车界面中的小车的显示效果。

本版本V0.1 支持的可绘制对象有以下三种：

对象名|基于高德API|设计意图和效果
---|------|-------
点标记|addMarker, addText|显示点标记的文本、图标；具备一定的交互效果和视觉效果；
线标记|addPolyline|显示一定效果的单线和折线，具备一定的状态更新和交互效果；
底图覆盖|addGroundOverlay|将图片嵌入地图图层

渲染引擎启动时，应获取和视角参数匹配的可交互对象。整个view支持：

- 支持有限级别的缩放；缩小时清空数据；限制显示对象的数量；
- 自动刷新可绘制对象的显示变量（如各种动态数据）：

## 可绘制对象封装

几个可绘制对象可以封装成一个交互对象。比如：

1个文本标签；1个线条；2者可共同属于一个停车位标记。标记应声明：

- 一致的绘制效果: 线条颜色，标签颜色，底色；
- 数据源：标签数据源的来源，应按照标记的id来从服务器动态获取；视图刷新时刷新。
- 点击效果：无论是线条点击还是标签点击，应有一致的弹出框；

地图对象数据结构：

- 父对象：设施实体（可能同时归属于2级的设施实体）：如车位的区域ParkingSection／小区设施级别(Unamed)
- 子对象：绘制实体

属性和方法表

项目|名称|描述
---|-----|-----
属性|ID|全局唯一索引
属性|ParentID|实体ID（可能可拆为2级）
属性|显示级别|和地图视角级别有关>2则该对象删除
属性|状态字典|kv字典，等于数据源返回的JSON
属性|数据源|服务器刷数据的api的path
属性|一致显示参数| fontColor, backgroundColor, fontSize, align, typeface, zIndex, lineWidth, lineColor, ..
属性

## 点标记


## 线段标记


## 底图标记

